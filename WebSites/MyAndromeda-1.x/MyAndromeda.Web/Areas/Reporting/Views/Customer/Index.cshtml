@{
    ViewBag.Title = "Index";
    
    var customerDetailActionUrl = Url.ActionClientTemplate("CustomerDetail", "Customer", new { Id = "#=Id #"});
    var translator = Html.GetTranslator();
}

<div class="header">
    <h3>Customers</h3>
</div>

@using (Html.BeginForm("ReadExcel", "Customer"))
{ 
    <input type="hidden" id="Title" name="Title" />
    <input type="hidden" id="Data" name="Data" />
    <input type="hidden" id="Model" name="Model" />
    @(Html.Kendo()
        .Grid<MyAndromeda.Web.Areas.Reporting.ViewModels.CustomerValueViewModel>()
        .Name("CustomerList")
        .ColumnMenu(c => { 
            c.Filterable(true);
            c.Columns(true);
            c.Filterable(true); 
        })
        .ToolBar(tools =>
        {
            tools.Template(@<text>
        <input type="submit" value="Excel" class="k-button k-button-for-excel" />
        </text>);
        })
        .Filterable().Sortable()
        .Columns(cols => {
        
            //cols.Bound(e => e.Id);
            cols.Bound(e => e.FirstName).Title(translator.T("First Name"));
            cols.Bound(e => e.LastName).Title(translator.T("Last Name"));

            cols.Bound(e => e.TotalOrders).Title(translator.T("Total Orders"));
            cols.Bound(e => e.TotalValue).ClientTemplate("#=kendo.toString(TotalValue, 'c')#").Title(translator.T("Total Value"));
            cols.Bound(e => e.AvgOrderValue).ClientTemplate("#=kendo.toString(AvgOrderValue, 'c')#").Title(translator.T("Avg Order Value"));
            cols.Bound(e => e.RegisteredDateTime).Title("Registered on").Title(translator.T("Registered On"));

            cols.Template(e => e.Id).ClientTemplate(string.Format("<a class='k-button' href='{0}'>{1}</a>", customerDetailActionUrl, translator.T("Open")));
        
        })
        .ClientDetailTemplateId("CustomerTemplateList")
        .Pageable(paging => paging.Refresh(true))
        .DataSource(data => {
            data.Ajax()
                .Read("ListValue", "Customer")
                .Model(e =>
                {
                    e.Id(m => m.Id);
                })
                .ServerOperation(false)
                .Sort(sort => {
                    sort.Add(m => m.TotalValue).Descending();
                })
                ;
        })
    )
}
@using (Html.BeginScripts())
{
    <script type="text/template" id="CustomerTemplateList">
        @(Html.Kendo()
            .TabStrip()
            .Name("CustomerTabe_#=Id#")
            .Items(items => {
                items.Add()
                    .Text("Orders")
                    .Selected(true)
                .Content(@<text>
                    @Html.Partial("_List_PreviousOrdersTemplate")
                </text>);
            
        }).ToClientTemplate())
    </script>
}

@using (Html.BeginScripts())
{
    if (false) { 
    <script src="~/Scripts/MyAndromeda.App.All.js"></script>
    }
    
    <script type="text/javascript">
        $(function () {
            var exportService = new MyAndromeda.GridExport.Services.KendoGridExcelExporter({
                title: "Customers",
                gridSelector: "#CustomerList",
                downloadSelector: "input.k-button-for-excel",
                titleSelector: "#Title",
                modelSelector: "#Model",
                dataSelector: "#Data"
            });
            exportService.init();
        });
    </script>
}


