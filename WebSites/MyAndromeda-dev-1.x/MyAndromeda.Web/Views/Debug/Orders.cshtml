@{
    var workContext = Html.GetWorkContext();
    var currentSite = workContext.CurrentSite;
}

<div id="GridAppDebug">

    <div ng-controller="startController">

        <orders-grid andromeda-site-id="@currentSite.AndromediaSiteId"></orders-grid>

    </div>

</div>


@using (Html.BeginScripts())
{
    //http://demos.telerik.com/kendo-ui/menu/context-menu-angular
    if (false)
    {
        <script src="~/lib/myandromeda/MyAndromeda.App.All.js"></script>
    }

    <script type="text/template" id="GridTemplate.html">
        <div kendo-grid
             k-options="gridOptions">

        </div>

        <div kendo-map
             k-options="mapOptions"
             style="height: 400px; position:relative">
        </div>

    </script>

    <script type="text/template" id="order-id-column.html">

        Id: {{dataItem.Id}}
        <br />
        External Order Ref: {{dataItem.ExternalOrderRef}}
        <a class="hasMenu btn btn-danger"
           ng-right-click="openMenu($event)">
            Right-click me
        </a>

        <ul kendo-context-menu="rowMenu" target="target">
            <li>
                Driver
                <ul>
                    <li>
                        <div class="well">
                            <div>
                                <label>Name</label>
                                <input type="text" ng-model="dataItem.Driver.Name"></input>
                            </div>
                            <div>
                                <label>Phone</label>
                                <input type="text" ng-model="dataItem.Driver.Phone"></input>
                            </div>
                            <input class="k-button" type="button" value="send" ng-click="createDriver(dataItem.Id, dataItem.Driver)" />
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                Web-hooks ... order status.
                <ul>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 0)">
                            0: Order Created
                        </a>
                    </li>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 1)">
                            1: Order has been received by the store
                        </a>
                    </li>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 2)">
                            2: Order is in oven
                        </a>
                    </li>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 3)">
                            3: Order is ready for dispatch
                        </a>
                    </li>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 4)">
                            4: Order is out for delivery
                        </a>
                    </li>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 5)">
                            5: Order has been completed
                        </a>
                    </li>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 6)">
                            6: Order has been canceled
                        </a>
                    </li>
                    <li>
                        <a href="#" ng-click="changeStatus(dataItem.Id, 8)">
                            8: Future Order
                        </a>
                    </li>

                </ul>
            </li>

            <li>
                IBS
                <ul>
                    <li>
                        <a target="_blank" href="/ibs/{{andromedaSiteId}}/getMenu">Get IBS Menu</a>
                    </li>
                    <li>
                        <a target="_blank" href="/ibs/{{andromedaSiteId}}/getCustomer/{{dataItem.Id}}"><i class="fa fa-user"></i> get customer</a>
                    </li>
                    <li>
                        <a target="_blank" href="/ibs/{{andromedaSiteId}}/addCustomer/{{dataItem.Id}}"><i class="fa fa-user"></i> add customer</a>
                    </li>
                    <li>
                        <a target="_blank" href="/ibs/{{andromedaSiteId}}/previewOrder/{{dataItem.Id}}"><i class="fa fa-paper-plane-o"></i> preview Order</a>

                    </li>
                    <li>
                        <a target="_blank" href="/ibs/{{andromedaSiteId}}/sendOrder/{{dataItem.Id}}"><i class="fa fa-paper-plane-o"></i> Send Order</a>
                    </li>
                    <li>
                        <a target="_blank" href="/ibs/{{andromedaSiteId}}/getLocations">Get Locations</a>
                    </li>
                    <li>
                        <a target="_blank" href="/ibs/{{andromedaSiteId}}/getPaymentTypes">Get Payment Types</a>
                    </li>
                </ul>
            </li>
        </ul>

    </script>

    <script type="text/template" id="order-item-count-column.html">
        {{dataItem.ItemCount}}
    </script>

    <script type="text/template" id="order-item-price-column.html">
        {{dataItem.FinalPrice}}
    </script>

    <script type="text/template" id="order-placed-time-column.html">
        {{dataItem.OrderPlacedTime}}
    </script>

    <script type="text/template" id="order-wanted-time-column.html">
        {{dataItem.OrderWantedTime}}
    </script>

    <script type="text/template" id="order-customer-column.html">
        <div style="display:none">{{dataItem.Customer.Id}}</div>
        <div>{{dataItem.Customer.Name}}</div>
        <div>{{dataItem.Customer.Phone}}</div>
        <div>{{dataItem.Customer.Email}}</div>
        <div>{{dataItem.Customer.Latitude}}</div>
        <div>{{dataItem.Customer.Longitude}}</div>
        <div>{{dataItem.Customer.Postcode}}</div>
    </script>

    <script type="text/template" id="order-detail-template.html">

        <tabs ng-controller="OrderDetailsController">
            <pane title="Food">
                <div ng-repeat="item in food.Items">
                    {{item.Qty}} - {{item.Name}} - {{item.Price}}
                </div>
            </pane>
            <pane title="Details - {{details.StatusDescription}}">
                <div class="row">
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">Charges</div>
                            <div class="panel-body">
                                Delivery: {{details.DeliveryCharge}}
                                <br />
                                Card Charges: {{details.CardCharges ? details.CardCharges : 0}}
                                <br />
                                Tips: {{details.Tips}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">Third party ids</div>
                            <div class="panel-body">
                                BringgId: {{details.BringgId}}
                                <br />
                                IBS Order Id: {{details.IbsOrderId}}
                                <br />
                                Rameses Ticket number: {{details.TicketNumber}}
                            </div>
                        </div>

                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">Delivery</div>
                            <div class="panel-body">
                                Postcode: {{details.OrderPostCode}}<br />
                                Driver: {{details.DriverName}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Instructions
                            </div>
                            <div class="panel-body">
                                <div class="col-md-4">
                                    Cooking Instructions: <br />
                                    <div ng-if="details.CookingInstructions">>{{details.CookingInstructions}}</div>
                                    <div ng-if="!details.CookingInstructions">{{details.CookingInstructions}}>None</div>
                                </div>
                                <div class="col-md-4">
                                    Customer Directions: <br />
                                    <div ng-if="details.CustomerDirections">>{{details.CustomerDirections}}</div>
                                    <div ng-if="!details.CustomerDirections">{{details.CustomerDirections}}>None</div>
                                </div>
                                <div class="col-md-4">
                                    Order Directions: <br />
                                    <div ng-if="details.OrderAddressDirections">>{{details.OrderAddressDirections}}</div>
                                    <div ng-if="!details.OrderAddressDirections">{{details.OrderAddressDirections}}>None</div>
                                </div>
                                <div class="col-md-12">
                                    Order Notes: <br />
                                    <div ng-if="details.OrderNotes">>{{details.OrderNotes}}</div>
                                    <div ng-if="!details.OrderNotes">{{details.OrderNotes}}>None</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>


            </pane>
            <pane title="Payment Lines">
                <div class="panel-body">

                    <div class="row">
                        <div class="col-sm-3">
                            PayTypeName
                        </div>
                        <div class="col-sm-3">
                            PaymentType
                        </div>
                        <div class="col-sm-3">
                            Value
                        </div>
                        <div class="col-sm-3">
                            Charge
                        </div>
                    </div>
                    <div class="row" ng-repeat="payLine in payments.PaymentLines">
                        <div class="col-sm-3">
                            {{payLine.PayTypeName}}
                        </div>
                        <div class="col-sm-3">
                            {{payLine.PaymentType}}
                        </div>
                        <div class="col-sm-3">
                            {{payLine.Value}}
                        </div>
                        <div class="col-sm-3">
                            {{payLine.Charge}}
                        </div>
                    </div>
                </div>

            </pane>
            <pane title="Order status">
                <div class="panel-body">
                    <div class="row" ng-if="!status.OrderStatusHistory">
                        <div class="col-sm-12">no records</div>
                    </div>
                    <div class="row" ng-repeat="status in status.OrderStatusHistory">
                        <div class="col-sm-1">
                            {{status.Id}}
                        </div>
                        <div class="col-sm-6">
                            {{status.Description}}
                        </div>
                        <div class="col-sm-3">
                            {{status.ChangeDateTime}}
                        </div>
                    </div>
                </div>

            </pane>
        </tabs>

    </script>

    @*<script type="text/template" id="order-detail-template.html">

            <div class="row">
                <div class="col-sm-4">
                    <div class="header">Food </div>
                    <div ng-repeat="item in dataItem.Items">
                        {{item.Qty}} - {{item.Name}} - {{item.Price}}
                    </div>
                </div>
                <div class="col-sm-8">
                    <div class="header">
                        Details - {{dataItem.StatusDescription}}
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="panel panel-default">
                                <div class="panel-heading">Charges</div>
                                <div class="panel-body">
                                    Delivery: {{dataItem.DeliveryCharge}}
                                    <br />
                                    Card Charges: {{dataItem.CardCharges ? dataItem.CardCharges : 0}}
                                    <br />
                                    Tips: {{dataItem.Tips}}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="panel panel-default">
                                <div class="panel-heading">Third party ids</div>
                                <div class="panel-body">
                                    BringgId: {{dataItem.BringgId}}
                                    <br />
                                    IBS Order Id: {{dataItem.IbsOrderId}}
                                    <br />
                                    Rameses Ticket number: {{dataItem.TicketNumber}}
                                </div>
                            </div>

                        </div>
                        <div class="col-md-4">
                            <div class="panel panel-default">
                                <div class="panel-heading">Delivery</div>
                                <div class="panel-body">
                                    Postcode: {{dataItem.OrderAddress.Postcode}}<br />
                                    Driver: {{dataItem.Driver.Name}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Instructions
                                </div>
                                <div class="panel-body">
                                    <div class="col-md-4">
                                        Cooking Instructions: <br />
                                        <div ng-if="dataItem.CookingInstructions">>{{dataItem.CookingInstructions}}</div>
                                        <div ng-if="!dataItem.CookingInstructions">{{dataItem.CookingInstructions}}>None</div>
                                    </div>
                                    <div class="col-md-4">
                                        Customer Directions: <br />
                                        <div ng-if="dataItem.Customer.Directions">>{{dataItem.Customer.Directions}}</div>
                                        <div ng-if="!dataItem.Customer.Directions">{{dataItem.Customer.Directions}}>None</div>
                                    </div>
                                    <div class="col-md-4">
                                        Order Directions: <br />
                                        <div ng-if="dataItem.OrderAddress.Directions">>{{dataItem.OrderAddress.Directions}}</div>
                                        <div ng-if="!dataItem.OrderAddress.Directions">{{dataItem.OrderAddress.Directions}}>None</div>
                                    </div>
                                    <div class="col-md-12">
                                        Order Notes: <br />
                                        <div ng-if="dataItem.OrderNotes">>{{dataItem.OrderNotes}}</div>
                                        <div ng-if="!dataItem.OrderNotes">{{dataItem.OrderNotes}}>None</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Payment Lines
                        </div>
                        <div class="panel-body">

                            <div class="row">
                                <div class="col-sm-3">
                                    PayTypeName
                                </div>
                                <div class="col-sm-3">
                                    PaymentType
                                </div>
                                <div class="col-sm-3">
                                    Value
                                </div>
                                <div class="col-sm-3">
                                    Charge
                                </div>
                            </div>
                            <div class="row" ng-repeat="payLine in dataItem.PaymentLines">
                                <div class="col-sm-3">
                                    {{payLine.PayTypeName}}
                                </div>
                                <div class="col-sm-3">
                                    {{payLine.PaymentType}}
                                </div>
                                <div class="col-sm-3">
                                    {{payLine.Value}}
                                </div>
                                <div class="col-sm-3">
                                    {{payLine.Charge}}
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Order status
                        </div>
                        <div class="panel-body">
                            <div class="row" ng-if="!dataItem.OrderStatusHistory">
                                <div class="col-sm-12">no records</div>
                            </div>
                            <div class="row" ng-repeat="status in dataItem.OrderStatusHistory">
                                <div class="col-sm-1">
                                    {{status.Id}}
                                </div>
                                <div class="col-sm-6">
                                    {{status.Description}}
                                </div>
                                <div class="col-sm-3">
                                    {{status.ChangeDateTime}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </script>*@

    <script type="text/javascript">
        $(function () {
            MyAndromeda.Debug.gridAppSetup("GridAppDebug");
        });
    </script>
}