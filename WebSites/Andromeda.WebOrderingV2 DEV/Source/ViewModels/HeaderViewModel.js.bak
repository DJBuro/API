/*
    Copyright © 2014 Andromeda Trading Limited.  All rights reserved.  
    THIS FILE AND ITS CONTENTS ARE PROTECTED BY COPYRIGHT AND/OR OTHER APPLICABLE LAW. 
    ANY USE OF THE CONTENTS OF THIS FILE OR ANY PART OF THIS FILE WITHOUT EXPLICIT PERMISSION FROM ANDROMEDA TRADING LIMITED IS PROHIBITED. 
*/

function HeaderViewModel()
{
    "use strict";

    var self = this;

    self.isShowStoreDetailsButtonVisible = ko.observable(true);
    self.isShowHomeButtonVisible = ko.observable(true);
    self.isShowMenuButtonVisible = ko.observable(true);
    self.isShowCartButtonVisible = ko.observable(true);

    self.isHeaderVisible = ko.observable(true);
    self.isPostcodeSelectorVisible = ko.observable(false);
    self.areHeaderOptionsVisible = ko.observable(true);
    self.isHeaderLoginVisible = ko.observable(true);

    // Mobile mode
    self.title = ko.observable(''); // Current section name - shown in the header
    self.titleClass = ko.observable(''); // Class to use to style the section name - used for showing an icon for the section

    self.username = ko.observable('');
    self.password = ko.observable('');

    self.isHomeSelected = ko.observable(true);
    self.isMenuSelected = ko.observable(false);
    self.isCartSelected = ko.observable(false);
    self.isMyProfileSelected = ko.observable(false);
    self.isStoreDetailsSelected = ko.observable(false);

    self.showHome = function ()
    {
        guiHelper.showHome();

        self.isHomeSelected(true);
        self.isMenuSelected(false);
        self.isCartSelected(false);
        self.isMyProfileSelected(false);
        self.isStoreDetailsSelected(false);
    };

    self.showMenu = function ()
    {
        guiHelper.showMenu();

        self.isHomeSelected(false);
        self.isMenuSelected(true);
        self.isCartSelected(false);
        self.isMyProfileSelected(false);
        self.isStoreDetailsSelected(false);
    };

    self.showCart = function ()
    {
        guiHelper.showCart();

        self.isHomeSelected(false);
        self.isMenuSelected(false);
        self.isCartSelected(true);
        self.isMyProfileSelected(false);
        self.isStoreDetailsSelected(false);
    };

    self.showStoreDetails = function()
    {
        guiHelper.showStoreDetails();

        self.isHomeSelected(false);
        self.isMenuSelected(false);
        self.isCartSelected(false);
        self.isMyProfileSelected(false);
        self.isStoreDetailsSelected(true);
    }

    self.login = function ()
    {
        if (!accountHelper.loginEnabled()) return;

        guiHelper.showView('loginView', new LoginViewModel(false));

        self.isHomeSelected(false);
        self.isMenuSelected(false);
        self.isCartSelected(false);
        self.isMyProfileSelected(true);
        self.isStoreDetailsSelected(false);
    };

    self.mobileLogin = function ()
    {
        if (!accountHelper.loginEnabled()) return;
        guiHelper.showView('loginView', new LoginViewModel(false));

        self.isHomeSelected(false);
        self.isMenuSelected(false);
        self.isCartSelected(false);
        self.isMyProfileSelected(true);
        self.isStoreDetailsSelected(false);
    };

    self.forgotPassword = function ()
    {
        if (!accountHelper.loginEnabled()) return;
        guiHelper.showView('passwordResetRequestView', new PasswordResetRequestViewModel());
    };

    self.mobileForgotPassword = function ()
    {
        if (!accountHelper.loginEnabled()) return;
        guiHelper.showView('passwordResetRequestView', new PasswordResetRequestViewModel());
    };

    self.register = function ()
    {
        if (!accountHelper.loginEnabled()) return;

        // Tell Google analytics that a register has been started
        ga
        (
            "send",
            "event",
            {
                eventCategory: "Account",
                eventAction: "Register",
                eventLabel: "Started",
                eventValue: 1,
                metric1: 1
            }
        );

        guiHelper.showView('registerFullView', new RegisterFullViewModel(false, undefined, accountHelper.isFacebookLogin));
    };

    self.mobileRegister = function ()
    {
        if (!accountHelper.loginEnabled()) return;

        // Tell Google analytics that a register has been started
        ga
        (
            "send",
            "event",
            {
                eventCategory: "Account",
                eventAction: "Register",
                eventLabel: "Started",
                eventValue: 1,
                metric1: 1
            }
        );

        guiHelper.showView('registerFullView', new RegisterFullViewModel(false, undefined, accountHelper.isFacebookLogin));
    };

    self.myProfile = function ()
    {
        if (accountHelper.isLoggedIn())
        {
            guiHelper.showView('myProfileView', new MyProfileViewModel());
        }
        else
        {
            self.mobileLogin();
        }
    };

    self.myOrders = function ()
    {
        guiHelper.showView('myOrdersView', new MyOrdersViewModel());
    };

    self.onLogout = function ()
    {
        viewModel.chooseStore();
    }

    self.logout = function ()
    {
        self.username('');
        self.password('');
        accountHelper.logout();
    };

    self.keyPress = function (data, event)
    {
        // Did the user press enter?
        if (event.which == 13 || event.keyCode == 13)
        {
            self.login();
            return false;
        }

        return true;
    }

    self.logoClicked = function ()
    {
        if (settings.logoClickReturnToStoreSelector)
        {
            // Show the store selector
            viewModel.chooseStore();
        }
        else if (settings.logoClickGotoParentWebsite)
        {
            // Redirect the browser to the parent website
            window.location.href = settings.logoClickUrl;
        }
        else
        {
            // Show the home page
            guiHelper.showHome();
        }
    }
};






































