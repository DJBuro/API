<?xml version="1.0" encoding="utf-8" ?>
<objects xmlns="http://www.springframework.net"
         xmlns:db="http://www.springframework.net/database">

    <!-- Referenced by main application context configuration file -->
    <description>
        The Order Tracking GPS object definitions for the Data Access Objects.
    </description>

    <object type="Spring.Objects.Factory.Config.PropertyPlaceholderConfigurer, Spring.Core">
        <property name="ConfigSections">
            <list>
                <value>databaseSettings</value>
                <value>SiteConfiguration</value>
            </list>
        </property>
    </object>

    <!-- Database and NHibernate Configuration -->
    <db:provider id="DbProvider"
                     provider="System.Data.SqlClient"
                     connectionString="Server=${db.datasource};Integrated Security=no;User ID=${db.user};PWD=${db.password};initial catalog=${db.database}"/>

    <object id="NHibernateSessionFactory" type="Spring.Data.NHibernate.LocalSessionFactoryObject, Spring.Data.NHibernate21">
        <property name="DbProvider" ref="DbProvider"/>
        <property name="MappingAssemblies">
            <list>
                <value>OrderTracking.Gps.Dao.NHibernate</value>
            </list>
        </property>

        <property name="HibernateProperties">
            <dictionary>
                <entry key="show_sql" value="false"/>
                <entry key="connection.isolation" value="ReadCommitted" />
                <entry key="default_schema" value="GpsGateServer.dbo" />

                <entry key="connection.provider"
                     value="NHibernate.Connection.DriverConnectionProvider"/>

                <entry key="dialect"
                       value="NHibernate.Dialect.MsSql2005Dialect"/>

                <entry key="connection.driver_class"
                       value="NHibernate.Driver.SqlClientDriver"/>

                <entry key="cache.use_second_level_cache"
                        value="false"/>
                <entry key="cache.use_query_cache"
                  value="false"/>

                <entry key="cache.current_session_context_class"
                       value="Spring.Data.NHibernate.SpringSessionContext"/>

            </dictionary>
        </property>
        <property name="ExposeTransactionAwareSessionFactory" value="true" />
    </object>

    <object id="transactionManager"
          type="Spring.Data.NHibernate.HibernateTransactionManager, Spring.Data.NHibernate21">

        <property name="DbProvider" ref="DbProvider"/>
        <property name="SessionFactory" ref="NHibernateSessionFactory"/>

    </object>

    <!-- Data Access Objects-->
    <object id="GenericHibernateDAOFactory" abstract="true">
        <property name="SessionFactory" ref="NHibernateSessionFactory"/>
    </object>

    <object id="OrderTrackingHibernateDaoFactory" type="OrderTracking.Gps.Dao.NHibernate.Dao.Factory.OrderTrackingGpsHibernateDAOFactory, OrderTracking.Gps.Dao.NHibernate" parent="GenericHibernateDAOFactory">
    </object>

    <object id="TrackDataDao" type="OrderTracking.Gps.Dao.NHibernate.TrackDataDao, OrderTracking.Gps.Dao.NHibernate" parent="GenericHibernateDAOFactory">
        <property name="OrderTrackingHibernateDaoFactory" ref="OrderTrackingHibernateDaoFactory"/>
    </object>
    <object id="DeviceDao" type="OrderTracking.Gps.Dao.NHibernate.DeviceDao, OrderTracking.Gps.Dao.NHibernate" parent="GenericHibernateDAOFactory">
        <property name="OrderTrackingHibernateDaoFactory" ref="OrderTrackingHibernateDaoFactory"/>
    </object>    
    <object id="UserDao" type="OrderTracking.Gps.Dao.NHibernate.UserDao, OrderTracking.Gps.Dao.NHibernate" parent="GenericHibernateDAOFactory">
        <property name="OrderTrackingHibernateDaoFactory" ref="OrderTrackingHibernateDaoFactory"/>
    </object>    
    <object id="GateUserDao" type="OrderTracking.Gps.Dao.NHibernate.GateUserDao, OrderTracking.Gps.Dao.NHibernate" parent="GenericHibernateDAOFactory">
        <property name="OrderTrackingHibernateDaoFactory" ref="OrderTrackingHibernateDaoFactory"/>
    </object>    
    <object id="UserGroupDao" type="OrderTracking.Gps.Dao.NHibernate.UserGroupDao, OrderTracking.Gps.Dao.NHibernate" parent="GenericHibernateDAOFactory">
        <property name="OrderTrackingHibernateDaoFactory" ref="OrderTrackingHibernateDaoFactory"/>
    </object>    
    <object id="LicenseDao" type="OrderTracking.Gps.Dao.NHibernate.LicenseDao, OrderTracking.Gps.Dao.NHibernate" parent="GenericHibernateDAOFactory">
        <property name="OrderTrackingHibernateDaoFactory" ref="OrderTrackingHibernateDaoFactory"/>
    </object>
</objects>
